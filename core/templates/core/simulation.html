{% extends 'core/base.html' %}
{% load static %}
{% load humanize %}
{% load l10n %} {# Adicionado para {% localize off %} #}

{% block title %}Resultados da Simula√ß√£o - W1 Holding Platform{% endblock %}

{% comment %}
O CSS e o link do Tailwind s√£o colocados no head_extra_styles, 
que √© o local mais apropriado no seu base.html.
{% endcomment %}
{% block head_extra_styles %}
    {{ block.super }}
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body { /* Garante fundo escuro se base.html n√£o o fizer */
            background-color: #022028;
            color: #fff;
        }
        .sim-page-container { /* Nome de classe mais espec√≠fico para esta p√°gina */
            max-width: none;
            width: 100%;
            padding: 20px;
            color: #fff;
            background: #022028;
            display: block;
        }
        .sim-section-container {
            width: 100%;
            max-width: 90vw; /* Usar vw pode ser um pouco imprevis√≠vel, considere % ou max-width fixo */
            margin: 0 auto;
            padding: 0;
            text-align: center;
        }
        .sim-content-box { /* Nome de classe mais espec√≠fico */
            background: #033038;
            padding: 30px;
            border-radius: 8px;
            /* width: 90vw; */ /* Removido, deixa o pai controlar a largura */
            margin: 0 auto 20px auto; /* Adicionado margin-bottom */
            box-sizing: border-box;
            text-align: left; /* Alinhamento padr√£o para conte√∫do interno */
        }
        .sim-logo {
            display: block; /* Para aplicar margin auto */
            max-width: 120px; /* Ajustado para um tamanho mais comum */
            margin: 0 auto 25px auto; /* Centralizado e com margem inferior */
        }
        .sim-content-box h1 {
            font-size: 2rem;
            font-family: "Cal Sans", sans-serif;
            color: #fff;
            text-align: center; /* T√≠tulo principal centralizado */
            margin-bottom: 0.5rem;
        }
        .sim-content-box > p.intro-text { /* Par√°grafo de introdu√ß√£o */
            text-align: center;
            font-size: 1.1rem;
            color: #9ca3af;
            font-family: "Montserrat", sans-serif;
            margin-bottom: 2rem;
        }

        .benefit-card h2 { /* T√≠tulos dentro dos cards de benef√≠cio */
            font-size: 1.5rem;
            color: #5fded4;
            font-family: "Cal Sans", sans-serif;
            margin-bottom: 15px;
            border-bottom: 1px solid #055058;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
        }
        .benefit-card h2 .fas { /* √çcones FontAwesome nos t√≠tulos */
            margin-right: 10px;
            font-size: 1.2em; /* Tamanho relativo ao h2 */
        }

        .benefit-card p, .summary-card p:not(.total-value-amount):not(.total-value-text) { /* Par√°grafos dentro dos cards */
            color: #d1d5db;
            font-family: "Montserrat", sans-serif;
            margin-bottom: 15px;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        .summary-card .total-value-text { /* Texto espec√≠fico no card de resumo */
            font-size: 1.1rem; color: #d1d5db; margin-bottom: 0.5rem; text-align: center;
        }
        .summary-card .total-value-amount { /* Valor total destacado */
            font-size: 2.5rem; color: #5fded4; font-weight: bold; display:block; margin-bottom:1.5rem;
            font-family: "Cal Sans", sans-serif; text-align: center;
        }


        .benefit-card, .summary-card { /* .card foi renomeado para .summary-card para clareza */
            background: #044048;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 1.5rem; /* Espa√ßamento entre cards no modo coluna */
            animation: fadeIn 0.6s ease-in-out;
        }
        
        .simulation-action-btn { /* Renomeado de .auth-btn para evitar conflitos */
            background-color: #5fded4;
            color: #022028;
            padding: 12px 25px; /* Padding ajustado */
            /* width: 60%; */ /* Removido para tamanho natural ou controle por grid/flex */
            border-radius: 4px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            transition: background-color 0.2s ease;
            font-family: "Montserrat", sans-serif;
            font-size: 1rem;
            text-align: center;
        }
        .simulation-action-btn:hover {
            background-color: #4acbc1;
        }
         .simulation-action-btn.secondary {
            background-color: transparent;
            border: 2px solid #5fded4;
            color: #5fded4;
        }
        .simulation-action-btn.secondary:hover {
            background-color: rgba(95, 222, 212, 0.1);
        }


        .dynamic-icons-display span { /* Para os √≠cones üè† üè¢ */
            font-size: 1.5rem;
            margin-right: 5px;
            display: inline-block;
        }
        
        canvas {
            max-width: 100%;
            width: 100% !important; /* For√ßa a largura para responsividade dentro do container */
            display: block;
            margin: 20px auto 0 auto; /* Adicionada margem superior */
            max-height: 300px;
            min-height: 200px;
        }
        
        .metrics-grid { /* Grid para os cards de m√©tricas menores */
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        .metric-card {
            background: #055058;
            padding: 15px;
            border-radius: 8px;
            flex: 1; /* Para que ocupem espa√ßo igualmente */
            min-width: 130px; /* Largura m√≠nima antes de quebrar linha */
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .metric-icon {
            font-size: 1.75rem; /* Ajustado para emojis */
            margin-bottom: 5px;
            line-height: 1;
        }
        .metric-label {
            font-size: 0.8rem; /* Reduzido */
            color: #9ca3af; /* Mais suave */
            text-transform: uppercase;
             min-height: 2.4em; /* Para acomodar 2 linhas de texto */
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 3px;
        }
        .metric-value {
            font-size: 1.05rem; /* Levemente aumentado */
            color: #fff;
            font-weight: bold;
        }
        .metric-value.highlight { color: #5fded4; } /* Para destacar valores de economia */

        .custom-table { /* Tabela para lucros de empresa */
            width: 100%;
            margin: 1.5rem 0;
            border-collapse: collapse;
            font-size: 0.85rem; /* Reduzido para caber melhor */
        }
        .custom-table th, .custom-table td {
            border: 1px solid #055058;
            padding: 6px 8px; /* Padding reduzido */
            text-align: left;
            color: #d1d5db;
        }
        .custom-table th {
            background-color: #055058;
            color: #5fded4;
            font-weight: 600;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
{% endblock head_extra_styles %}

{% block header_content %}{% endblock %}
{% block footer %}{% endblock %}

{% block scripts %}{% endblock %} {# Esvazia scripts do base.html para controle total abaixo #}

{% block content %}
<div class="sim-page-container">
    <section class="sim-section-container">
        <div class="sim-content-box">
            <img src="{% static 'images/logo.png' %}" alt="W1 Logo" class="sim-logo">
            <h1>Resultados da Simula√ß√£o</h1>
            <p class="intro-text">Veja como uma holding pode transformar sua gest√£o patrimonial, {% if user.first_name %}{{ user.first_name.split.0|capfirst }}{% else %}{{ user.email.split|first|capfirst }}{% endif %}!</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> {# Se√ß√µes de benef√≠cios principais #}
                {% if number_of_properties > 0 %}
                    <div class="benefit-card">
                        <h2><i class="fas fa-home"></i> Seus Im√≥veis e Sucess√£o</h2>
                        <div id="property-icons" class="dynamic-icons-display"></div>
                        <p>{{ inventory_text|safe }}</p>
                        {% if number_of_heirs > 0 %}
                            <p class="mt-3">{{ succession_text|safe }}</p>
                            <div class="metrics-grid">
                                <div class="metric-card">
                                    <span class="metric-icon">üßæ</span>
                                    <div class="metric-label">Custo Invent√°rio (S/ Holding)</div>
                                    <div class="metric-value highlight">R$ {{ inventory_cost_without|floatformat:2|intcomma }}</div>
                                </div>
                                <div class="metric-card">
                                    <span class="metric-icon">‚è≥</span>
                                    <div class="metric-label">Tempo M√©dio Invent√°rio</div>
                                    <div class="metric-value">{{ inventory_time_without }} meses</div>
                                </div>
                                <div class="metric-card">
                                    <span class="metric-icon">‚öñÔ∏è</span>
                                    <div class="metric-label">Risco de Conflito</div>
                                    <div class="metric-value">{{ conflict_risk }}</div>
                                </div>
                                <div class="metric-card">
                                    <span class="metric-icon">‚úÖ</span>
                                    <div class="metric-label">Com Holding</div>
                                    <div class="metric-value">Planejado em Vida</div>
                                </div>
                            </div>
                        {% endif %}
                        <canvas id="inventoryChart"></canvas>
                    </div>
                {% endif %}

                {% if has_companies == 'yes' and number_of_companies > 0 %}
                    <div class="benefit-card">
                        <h2><i class="fas fa-briefcase"></i> Suas Empresas</h2>
                        <div id="company-icons" class="dynamic-icons-display"></div>
                        <p>{{ profit_text|safe }}</p>
                        {% if company_tax_regime != 'simples' and monthly_profit > 0 %}
                            <table class="custom-table">
                                <thead>
                                    <tr><th>Regime</th><th>Lucro Anual</th><th>IRPF (S/ Holding)</th><th>IRPF (C/ Holding)</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>{{ company_tax_regime|capfirst }}</td>
                                        <td>R$ {% localize off %}{{ annual_profit|floatformat:2|intcomma }}{% endlocalize %}</td>
                                        <td>~{% localize off %}{{ PROFIT_TAX_PF|floatformat:1 }}{% endlocalize %}%</td>
                                        <td>Isento</td>
                                    </tr>
                                </tbody>
                            </table>
                            <canvas id="profitChart"></canvas>
                        {% elif company_tax_regime == 'simples' %}
                             <p>Empresas no Simples Nacional j√° possuem isen√ß√£o na distribui√ß√£o de lucros. A holding pode oferecer outras vantagens.</p>
                        {% endif %}
                    </div>
                {% endif %}

                {% if receives_rent == 'yes' and monthly_rent > 0 %}
                    <div class="benefit-card">
                        <h2><i class="fas fa-key"></i> Seus Alugu√©is</h2>
                        <p>{{ rental_text|safe }}</p>
                        <canvas id="rentalChart"></canvas>
                    </div>
                {% endif %}
            </div>

           <div class="summary-card mt-8"> {# Adicionado mt-8 para espa√ßar do grid acima #}
                <h2><i class="fas fa-piggy-bank"></i> Resumo dos Benef√≠cios</h2>
                <div class="grid grid-cols-1 lg:grid-cols-7 gap-4 items-center">
                    <div class="lg:col-span-2 flex flex-col justify-center gap-4">
                        {% if inventory_savings > 0 %}
                            <div class="metric-card">
                                <span class="metric-icon">üßæ</span>
                                <div class="metric-label">Invent√°rio Evitado</div>
                                <div class="metric-value highlight">R$ {% localize off %}{{ inventory_savings|floatformat:2|intcomma }}{% endlocalize %}</div>
                            </div>
                        {% endif %}
                        {% if profit_savings > 0 %}
                            <div class="metric-card">
                                <span class="metric-icon">üí∞</span>
                                <div class="metric-label">Economia Lucros</div>
                                <div class="metric-value highlight">R$ {% localize off %}{{ profit_savings|floatformat:2|intcomma }}{% endlocalize %}</div>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="lg:col-span-3">
                        {% if total_savings > 0 %}
                            <div style="max-height: 300px; min-height: 250px; margin: 1rem 0;">
                                <canvas id="totalSavingsChart"></canvas>
                            </div>
                        {% endif %}
                        <p class="total-value-text mt-4">Economia Total Estimada:</p>
                        <p class="total-value-amount">R$ {% localize off %}{{ total_savings|floatformat:2|intcomma }}{% endlocalize %}</p>
                    </div>
                    
                    <div class="lg:col-span-2 flex flex-col justify-center gap-4">
                        {% if rental_savings > 0 %}
                            <div class="metric-card">
                                <span class="metric-icon">üè¢</span>
                                <div class="metric-label">Economia Alugu√©is</div>
                                <div class="metric-value highlight">R$ {% localize off %}{{ rental_savings|floatformat:2|intcomma }}{% endlocalize %}</div>
                            </div>
                        {% endif %}
                        {% if number_of_heirs > 0 and inventory_time_without > 0 %}
                            <div class="metric-card">
                                <span class="metric-icon">‚è≥</span>
                                <div class="metric-label">Tempo Invent√°rio Economizado</div>
                                <div class="metric-value">{% localize off %}{{ inventory_time_without }}{% endlocalize %} meses</div>
                            </div>
                        {% endif %}
                    </div>
                </div>
                <p class="mt-6 text-gray-400 px-4">Esta √© uma estimativa da economia que uma holding pode proporcionar em impostos e custos de invent√°rio, al√©m de agilizar o planejamento sucess√≥rio.</p>
                <div class="mt-8 flex flex-col sm:flex-row justify-center gap-4">
                    <a href="{% url 'create_holding' %}" class="simulation-action-btn">Quero Criar Minha Holding!</a>
                    <a href="{% url 'dashboard' %}" class="simulation-action-btn secondary">Refazer Simula√ß√£o</a>
                </div>
            </div>
        </div>
    </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    console.log("DEBUG: Iniciando script de gr√°ficos da simula√ß√£o...");

    const numberOfProperties = {% localize off %}{{ number_of_properties|default:0 }}{% endlocalize %};
    const totalPropertyValue = {% localize off %}{{ total_property_value|default:0 }}{% endlocalize %};
    const inventoryCostWithout = {% localize off %}{{ inventory_cost_without|default:0 }}{% endlocalize %};
    const inventorySavings = {% localize off %}{{ inventory_savings|default:0 }}{% endlocalize %};
    const hasCompanies = '{{ has_companies|default:"no" }}' === 'yes';
    const numberOfCompanies = {% localize off %}{{ number_of_companies|default:0 }}{% endlocalize %};
    const companyTaxRegime = '{{ company_tax_regime|default:"" }}';
    const monthlyProfit = {% localize off %}{{ monthly_profit|default:0 }}{% endlocalize %};
    const annualProfit = {% localize off %}{{ annual_profit|default:0 }}{% endlocalize %};
    const profitSavings = {% localize off %}{{ profit_savings|default:0 }}{% endlocalize %};
    const receivesRent = '{{ receives_rent|default:"no" }}' === 'yes';
    const monthlyRent = {% localize off %}{{ monthly_rent|default:0 }}{% endlocalize %};
    const annualRent = {% localize off %}{{ annual_rent|default:0 }}{% endlocalize %};
    const rentalSavings = {% localize off %}{{ rental_savings|default:0 }}{% endlocalize %};
    const totalSavings = {% localize off %}{{ total_savings|default:0 }}{% endlocalize %};
    const RENTAL_TAX_PF_RATE = {% localize off %}{{ RENTAL_TAX_PF|default:0 }}{% endlocalize %} / 100;
    const RENTAL_TAX_PJ_RATE = {% localize off %}{{ RENTAL_TAX_PJ|default:0 }}{% endlocalize %} / 100;
    const PROFIT_TAX_PF_RATE = {% localize off %}{{ PROFIT_TAX_PF|default:0 }}{% endlocalize %} / 100;

    console.log("DEBUG: Valores para Gr√°ficos:", {
        numberOfProperties, totalPropertyValue, inventoryCostWithout, inventorySavings,
        hasCompanies, numberOfCompanies, companyTaxRegime, annualProfit, profitSavings,
        receivesRent, annualRent, rentalSavings, totalSavings,
        RENTAL_TAX_PF_RATE, RENTAL_TAX_PJ_RATE, PROFIT_TAX_PF_RATE
    });

    Chart.defaults.color = '#d1d5db';
    Chart.defaults.font.family = "'Montserrat', sans-serif";
    Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(5, 80, 88, 0.95)';
    Chart.defaults.plugins.tooltip.titleFont = { size: 14, weight: 'bold', family: "'Cal Sans', sans-serif" };
    Chart.defaults.plugins.tooltip.bodyFont = { size: 12 };
    Chart.defaults.plugins.tooltip.padding = 10;
    Chart.defaults.plugins.tooltip.cornerRadius = 4;
    Chart.defaults.plugins.tooltip.usePointStyle = true;

    const tooltipLabelCallback = function(context) {
        let label = context.dataset.label || '';
        if (label) { label += ': '; }
        let value = null;
        if (context.parsed.y !== null && context.parsed.y !== undefined) { value = context.parsed.y; }
        else if (context.parsed.x !== null && context.parsed.x !== undefined) { value = context.parsed.x; }
        if (value !== null) {
            label += `R$ ${value.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }
        return label;
    };
    const pieTooltipLabelCallback = function(context) {
        const value = context.raw;
        return `${context.label}: R$ ${value.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    };
    
    const propertyIconsDiv = document.getElementById('property-icons');
    if (propertyIconsDiv && numberOfProperties > 0) {
        for (let i = 0; i < Math.min(numberOfProperties, 7); i++) { // Limitado para n√£o estourar layout
            const icon = document.createElement('span'); icon.textContent = 'üè†'; propertyIconsDiv.appendChild(icon);
        }
    }
    const companyIconsDiv = document.getElementById('company-icons');
    if (companyIconsDiv && numberOfCompanies > 0) {
        for (let i = 0; i < Math.min(numberOfCompanies, 7); i++) {
            const icon = document.createElement('span'); icon.textContent = 'üè¢'; companyIconsDiv.appendChild(icon);
        }
    }

    // Gr√°fico de Invent√°rio
    if (document.getElementById('inventoryChart') && numberOfProperties > 0 && inventorySavings > 0) {
        const inventoryCtx = document.getElementById('inventoryChart').getContext('2d');
        console.log("DEBUG: Renderizando Gr√°fico de Invent√°rio. Dados:", [inventoryCostWithout, inventorySavings]);
        new Chart(inventoryCtx, {
            type: 'bar',
            data: {
                labels: ['Custo S/ Holding', 'Economia C/ Holding'],
                datasets: [{
                    label: 'Valor (R$)', data: [inventoryCostWithout, inventorySavings],
                    backgroundColor: ['#ef4444', '#5fded4'], borderColor: ['#dc2626', '#4acbc1'], borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                scales: { x: { beginAtZero: true, ticks: { color: '#d1d5db', callback: value => `R$ ${value.toLocaleString('pt-BR')}` } }, y: { ticks: { color: '#d1d5db' } } },
                plugins: { legend: { display: false }, tooltip: { callbacks: { label: tooltipLabelCallback } } }
            }
        });
    } else { console.log("DEBUG: Gr√°fico de Invent√°rio n√£o renderizado (condi√ß√µes n√£o atendidas)."); }

    // Gr√°fico de Lucros
    if (document.getElementById('profitChart') && hasCompanies && companyTaxRegime !== 'simples' && annualProfit > 0) {
        const profitCtx = document.getElementById('profitChart').getContext('2d');
        const taxWithoutHolding = annualProfit * PROFIT_TAX_PF_RATE;
        const taxWithHolding = 0; 
        if (taxWithoutHolding > 0) {
            console.log("DEBUG: Renderizando Gr√°fico de Lucros. Dados:", [taxWithoutHolding, taxWithHolding]);
            new Chart(profitCtx, {
                type: 'bar',
                data: {
                    labels: ['Imposto Lucro (PF S/ Holding)', 'Imposto (PF C/ Holding)'],
                    datasets: [{
                        label: 'Imposto Anual (R$)', data: [taxWithoutHolding, taxWithHolding],
                        backgroundColor: ['#ef4444', '#5fded4'], borderColor: ['#dc2626', '#4acbc1'], borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                    scales: { x: { beginAtZero: true, ticks: { color: '#d1d5db', callback: value => `R$ ${value.toLocaleString('pt-BR')}` } }, y: { ticks: { color: '#d1d5db' } } },
                    plugins: { legend: { display: false }, tooltip: { callbacks: { label: tooltipLabelCallback } } }
                }
            });
        } else { console.log("DEBUG: Gr√°fico de Lucros n√£o renderizado (taxWithoutHolding <= 0).");}
    } else { console.log("DEBUG: Gr√°fico de Lucros n√£o renderizado (condi√ß√µes HTML/JS)."); }

    // Gr√°fico de Alugu√©is
    if (document.getElementById('rentalChart') && receivesRent && annualRent > 0 && rentalSavings > 0) {
        const rentalCtx = document.getElementById('rentalChart').getContext('2d');
        const taxWithoutHolding = annualRent * RENTAL_TAX_PF_RATE;
        const taxWithHolding = annualRent * RENTAL_TAX_PJ_RATE;
        console.log("DEBUG: Renderizando Gr√°fico de Alugu√©is. Dados:", [taxWithoutHolding, taxWithHolding]);
        new Chart(rentalCtx, {
            type: 'bar',
            data: {
                labels: ['Imposto Aluguel (PF)', 'Imposto Aluguel (Holding PJ)'],
                datasets: [{
                    label: 'Imposto Anual (R$)', data: [taxWithoutHolding, taxWithHolding],
                    backgroundColor: ['#ef4444', '#5fded4'], borderColor: ['#dc2626', '#4acbc1'], borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                scales: { x: { beginAtZero: true, ticks: { color: '#d1d5db', callback: value => `R$ ${value.toLocaleString('pt-BR')}` } }, y: { ticks: { color: '#d1d5db' } } },
                plugins: { legend: { display: false }, tooltip: { callbacks: { label: tooltipLabelCallback } } }
            }
        });
    } else { console.log("DEBUG: Gr√°fico de Alugu√©is n√£o renderizado (condi√ß√µes n√£o atendidas)."); }

    // Gr√°fico de Pizza
    if (document.getElementById('totalSavingsChart') && totalSavings > 0) {
        const totalSavingsCtx = document.getElementById('totalSavingsChart').getContext('2d');
        const savingsData = [];
        const savingsLabels = [];
        const savingsColors = ['#8b5cf6', '#ec4899', '#10b981', '#f59e0b', '#3b82f6']; 

        if (inventorySavings > 0) { savingsData.push(inventorySavings); savingsLabels.push('Invent√°rio'); }
        if (profitSavings > 0) { savingsData.push(profitSavings); savingsLabels.push('Lucros Empresa'); }
        if (rentalSavings > 0) { savingsData.push(rentalSavings); savingsLabels.push('Alugu√©is'); }

        if (savingsData.length > 0) {
            console.log("DEBUG: Renderizando Gr√°fico de Pizza. Labels:", savingsLabels, "Dados:", savingsData);
            new Chart(totalSavingsCtx, {
                type: 'pie',
                data: {
                    labels: savingsLabels,
                    datasets: [{
                        label: 'Distribui√ß√£o da Economia', data: savingsData,
                        backgroundColor: savingsColors.slice(0, savingsData.length),
                        borderColor: '#033038', borderWidth: 2, hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { color: '#d1d5db', padding: 15, font: {size: 11} } },
                        tooltip: { callbacks: { label: pieTooltipLabelCallback } },
                        title: { display: true, text: 'Composi√ß√£o da Economia Total', color: '#5fded4', padding: {top:0, bottom:15}, font: {size:16, family:"'Cal Sans', sans-serif"} }
                    }
                }
            });
        } else {
             console.log("DEBUG: Gr√°fico de Pizza: Economia total √© positiva (",totalSavings,") mas nenhum componente para detalhar.");
        }
    } else { console.log("DEBUG: Gr√°fico de Pizza n√£o renderizado (totalSavings <= 0)."); }
});
</script>
{% endblock content %}